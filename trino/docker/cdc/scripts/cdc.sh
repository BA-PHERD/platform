#!/bin/bash

END_TIMESTAMP=0
RUN_SUCCESS=1
while :
do
    if [[ $RUN_SUCCESS == 1 ]]
    then
        START_TIMESTAMP="$END_TIMESTAMP"
    fi
    END_TIMESTAMP="$EPOCHSECONDS"

    echo "$(date) - Starting CDC with interval [$START_TIMESTAMP, $END_TIMESTAMP[ ..."

    ./trino --server "$TRINO_ENDPOINT" --user trino --execute "
        -- READ UNCOMMITTED should be enough because we do not allow updates (only inserts) and we limit the results using the time interval
        START TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;


        MERGE INTO hive.default.patients AS target_patients
        USING (
            SELECT owner_id, id, current_diagnose, age, sex, right_handed, schooling, egfr, first_visit, diagnose_date, a, t, n, memoria, memoria_esordio, fx_esecutive, fx_esecutive_esordio, fx_visuo_spaziali, fx_visuo_spaziali_esordio, linguaggio, linguaggio_esordio, fx_pratto_gnosiche, fx_pratto_gnosiche_esordio, social_cognition, social_cognition_esordio, comportamento, comportamento_esordio, extrapiramidale, adl, iadl, cdr, cdr_sob, tau_totale_liquor, ptau_181_liquor, ttau_ptau, mta, fazekas, koedam, gca, vascular, pet_fdg, spect, pet_a, mmse_raw, mmse_corr, fab_raw, fab_corr, memoria_di_prosa_immediata_raw, memoria_di_prosa_immediata_corr, memoria_di_prosa_differita_raw, memoria_di_prosa_differita_corr, fcsrt_immediate_free_recall_raw, fcsrt_immediate_free_recall_corr, fcsrt_delayed_free_recall_raw, fcsrt_delayed_free_recall_corr, fcsrt_isc, fcsrt_itr, fcsrt_dtr, ravlt_immediato_raw, ravlt_immediato_corr, ravlt_differito_raw, ravlt_differito_corr, ravlt_recognition, digit_span_diretto_raw, digit_span_diretto_corr, digit_span_inverso_raw, digit_span_inverso_corr, corsi_block_tapping_test_raw, corsi_block_tapping_test_corr, figura_di_rey_differita, figura_di_rey_differita_corr, matrici_attentive_raw, matrici_attentive_corr, tmt_a_raw, tmt_a_corr, tmt_b_raw, tmt_b_corr, stroop_test_tempo_raw, stroop_test_tempo_corr, stroop_test_errori_raw, stroop_test_errori_corr, fluenza_verbale_fonemica_raw, fluenza_verbale_fonemica_corr, fluenza_verbale_semantica_raw, fluenza_verbale_semantica_corr, clock_drawing_test_raw, figura_di_rey_copia, test_di_prassia_costruttiva_raw, test_di_prassia_costruttiva_corr, gds, bdi, stai_i, stai_ii, social_cognition_gs_raw, social_cognition_gs_corr, social_cognition_ia_raw, social_cognition_ia_corr, social_cognition_ea_raw, social_cognition_ea_corr, social_cognition_ci_raw, social_cognition_ci_corr, cri_totale_raw, cri_tempo_libero_raw, cri_lavoro_raw, cri_scuola_raw, test_linguistici_nndd, _timestamp
            FROM kafka.devprin.patients
            WHERE _timestamp >= from_unixtime($START_TIMESTAMP) AND _timestamp < from_unixtime($END_TIMESTAMP)
        ) AS kafka_source
        ON target_patients.id = kafka_source.id AND target_patients.owner_id = kafka_source.owner_id
        WHEN MATCHED THEN
            UPDATE SET target_patients.current_diagnose = kafka_source.current_diagnose, target_patients.age = kafka_source.age, target_patients.sex = kafka_source.sex, target_patients.right_handed = kafka_source.right_handed, target_patients.schooling = kafka_source.schooling, target_patients.egfr = kafka_source.egfr, target_patients.first_visit = kafka_source.first_visit, target_patients.diagnose_date = kafka_source.diagnose_date, target_patients.a = kafka_source.a, target_patients.t = kafka_source.t, target_patients.n = kafka_source.n, target_patients.memoria = kafka_source.memoria, target_patients.memoria_esordio = kafka_source.memoria_esordio, target_patients.fx_esecutive = kafka_source.fx_esecutive, target_patients.fx_esecutive_esordio = kafka_source.fx_esecutive_esordio, target_patients.fx_visuo_spaziali = kafka_source.fx_visuo_spaziali, target_patients.fx_visuo_spaziali_esordio = kafka_source.fx_visuo_spaziali_esordio, target_patients.linguaggio = kafka_source.linguaggio, target_patients.linguaggio_esordio = kafka_source.linguaggio_esordio, target_patients.fx_pratto_gnosiche = kafka_source.fx_pratto_gnosiche, target_patients.fx_pratto_gnosiche_esordio = kafka_source.fx_pratto_gnosiche_esordio, target_patients.social_cognition = kafka_source.social_cognition, target_patients.social_cognition_esordio = kafka_source.social_cognition_esordio, target_patients.comportamento = kafka_source.comportamento, target_patients.comportamento_esordio = kafka_source.comportamento_esordio, target_patients.extrapiramidale = kafka_source.extrapiramidale, target_patients.adl = kafka_source.adl, target_patients.iadl = kafka_source.iadl, target_patients.cdr = kafka_source.cdr, target_patients.cdr_sob = kafka_source.cdr_sob, target_patients.tau_totale_liquor = kafka_source.tau_totale_liquor, target_patients.ptau_181_liquor = kafka_source.ptau_181_liquor, target_patients.ttau_ptau = kafka_source.ttau_ptau, target_patients.mta = kafka_source.mta, target_patients.fazekas = kafka_source.fazekas, target_patients.koedam = kafka_source.koedam, target_patients.gca = kafka_source.gca, target_patients.vascular = kafka_source.vascular, target_patients.pet_fdg = kafka_source.pet_fdg, target_patients.spect = kafka_source.spect, target_patients.pet_a = kafka_source.pet_a, target_patients.mmse_raw = kafka_source.mmse_raw, target_patients.mmse_corr = kafka_source.mmse_corr, target_patients.fab_raw = kafka_source.fab_raw, target_patients.fab_corr = kafka_source.fab_corr, target_patients.memoria_di_prosa_immediata_raw = kafka_source.memoria_di_prosa_immediata_raw, target_patients.memoria_di_prosa_immediata_corr = kafka_source.memoria_di_prosa_immediata_corr, target_patients.memoria_di_prosa_differita_raw = kafka_source.memoria_di_prosa_differita_raw, target_patients.memoria_di_prosa_differita_corr = kafka_source.memoria_di_prosa_differita_corr, target_patients.fcsrt_immediate_free_recall_raw = kafka_source.fcsrt_immediate_free_recall_raw, target_patients.fcsrt_immediate_free_recall_corr = kafka_source.fcsrt_immediate_free_recall_corr, target_patients.fcsrt_delayed_free_recall_raw = kafka_source.fcsrt_delayed_free_recall_raw, target_patients.fcsrt_delayed_free_recall_corr = kafka_source.fcsrt_delayed_free_recall_corr, target_patients.fcsrt_isc = kafka_source.fcsrt_isc, target_patients.fcsrt_itr = kafka_source.fcsrt_itr, target_patients.fcsrt_dtr = kafka_source.fcsrt_dtr, target_patients.ravlt_immediato_raw = kafka_source.ravlt_immediato_raw, target_patients.ravlt_immediato_corr = kafka_source.ravlt_immediato_corr, target_patients.ravlt_differito_raw = kafka_source.ravlt_differito_raw, target_patients.ravlt_differito_corr = kafka_source.ravlt_differito_corr, target_patients.ravlt_recognition = kafka_source.ravlt_recognition, target_patients.digit_span_diretto_raw = kafka_source.digit_span_diretto_raw, target_patients.digit_span_diretto_corr = kafka_source.digit_span_diretto_corr, target_patients.digit_span_inverso_raw = kafka_source.digit_span_inverso_raw, target_patients.digit_span_inverso_corr = kafka_source.digit_span_inverso_corr, target_patients.corsi_block_tapping_test_raw = kafka_source.corsi_block_tapping_test_raw, target_patients.corsi_block_tapping_test_corr = kafka_source.corsi_block_tapping_test_corr, target_patients.figura_di_rey_differita = kafka_source.figura_di_rey_differita, target_patients.figura_di_rey_differita_corr = kafka_source.figura_di_rey_differita_corr, target_patients.matrici_attentive_raw = kafka_source.matrici_attentive_raw, target_patients.matrici_attentive_corr = kafka_source.matrici_attentive_corr, target_patients.tmt_a_raw = kafka_source.tmt_a_raw, target_patients.tmt_a_corr = kafka_source.tmt_a_corr, target_patients.tmt_b_raw = kafka_source.tmt_b_raw, target_patients.tmt_b_corr = kafka_source.tmt_b_corr, target_patients.stroop_test_tempo_raw = kafka_source.stroop_test_tempo_raw, target_patients.stroop_test_tempo_corr = kafka_source.stroop_test_tempo_corr, target_patients.stroop_test_errori_raw = kafka_source.stroop_test_errori_raw, target_patients.stroop_test_errori_corr = kafka_source.stroop_test_errori_corr, target_patients.fluenza_verbale_fonemica_raw = kafka_source.fluenza_verbale_fonemica_raw, target_patients.fluenza_verbale_fonemica_corr = kafka_source.fluenza_verbale_fonemica_corr, target_patients.fluenza_verbale_semantica_raw = kafka_source.fluenza_verbale_semantica_raw, target_patients.fluenza_verbale_semantica_corr = kafka_source.fluenza_verbale_semantica_corr, target_patients.clock_drawing_test_raw = kafka_source.clock_drawing_test_raw, target_patients.figura_di_rey_copia = kafka_source.figura_di_rey_copia, target_patients.test_di_prassia_costruttiva_raw = kafka_source.test_di_prassia_costruttiva_raw, target_patients.test_di_prassia_costruttiva_corr = kafka_source.test_di_prassia_costruttiva_corr, target_patients.gds = kafka_source.gds, target_patients.bdi = kafka_source.bdi, target_patients.stai_i = kafka_source.stai_i, target_patients.stai_ii = kafka_source.stai_ii, target_patients.social_cognition_gs_raw = kafka_source.social_cognition_gs_raw, target_patients.social_cognition_gs_corr = kafka_source.social_cognition_gs_corr, target_patients.social_cognition_ia_raw = kafka_source.social_cognition_ia_raw, target_patients.social_cognition_ia_corr = kafka_source.social_cognition_ia_corr, target_patients.social_cognition_ea_raw = kafka_source.social_cognition_ea_raw, target_patients.social_cognition_ea_corr = kafka_source.social_cognition_ea_corr, target_patients.social_cognition_ci_raw = kafka_source.social_cognition_ci_raw, target_patients.social_cognition_ci_corr = kafka_source.social_cognition_ci_corr, target_patients.cri_totale_raw = kafka_source.cri_totale_raw, target_patients.cri_tempo_libero_raw = kafka_source.cri_tempo_libero_raw, target_patients.cri_lavoro_raw = kafka_source.cri_lavoro_raw, target_patients.cri_scuola_raw = kafka_source.cri_scuola_raw, target_patients.test_linguistici_nndd = kafka_source.test_linguistici_nndd, target_patients.clinical_data_upsert_at = kafka_source._timestamp
        WHEN NOT MATCHED THEN          
            INSERT (owner_id, id, current_diagnose, age, sex, right_handed, schooling, egfr, first_visit, diagnose_date, a, t, n, memoria, memoria_esordio, fx_esecutive, fx_esecutive_esordio, fx_visuo_spaziali, fx_visuo_spaziali_esordio, linguaggio, linguaggio_esordio, fx_pratto_gnosiche, fx_pratto_gnosiche_esordio, social_cognition, social_cognition_esordio, comportamento, comportamento_esordio, extrapiramidale, adl, iadl, cdr, cdr_sob, tau_totale_liquor, ptau_181_liquor, ttau_ptau, mta, fazekas, koedam, gca, vascular, pet_fdg, spect, pet_a, mmse_raw, mmse_corr, fab_raw, fab_corr, memoria_di_prosa_immediata_raw, memoria_di_prosa_immediata_corr, memoria_di_prosa_differita_raw, memoria_di_prosa_differita_corr, fcsrt_immediate_free_recall_raw, fcsrt_immediate_free_recall_corr, fcsrt_delayed_free_recall_raw, fcsrt_delayed_free_recall_corr, fcsrt_isc, fcsrt_itr, fcsrt_dtr, ravlt_immediato_raw, ravlt_immediato_corr, ravlt_differito_raw, ravlt_differito_corr, ravlt_recognition, digit_span_diretto_raw, digit_span_diretto_corr, digit_span_inverso_raw, digit_span_inverso_corr, corsi_block_tapping_test_raw, corsi_block_tapping_test_corr, figura_di_rey_differita, figura_di_rey_differita_corr, matrici_attentive_raw, matrici_attentive_corr, tmt_a_raw, tmt_a_corr, tmt_b_raw, tmt_b_corr, stroop_test_tempo_raw, stroop_test_tempo_corr, stroop_test_errori_raw, stroop_test_errori_corr, fluenza_verbale_fonemica_raw, fluenza_verbale_fonemica_corr, fluenza_verbale_semantica_raw, fluenza_verbale_semantica_corr, clock_drawing_test_raw, figura_di_rey_copia, test_di_prassia_costruttiva_raw, test_di_prassia_costruttiva_corr, gds, bdi, stai_i, stai_ii, social_cognition_gs_raw, social_cognition_gs_corr, social_cognition_ia_raw, social_cognition_ia_corr, social_cognition_ea_raw, social_cognition_ea_corr, social_cognition_ci_raw, social_cognition_ci_corr, cri_totale_raw, cri_tempo_libero_raw, cri_lavoro_raw, cri_scuola_raw, test_linguistici_nndd, clinical_data_upsert_at)
            VALUES (kafka_source.owner_id, kafka_source.id, kafka_source.current_diagnose, kafka_source.age, kafka_source.sex, kafka_source.right_handed, kafka_source.schooling, kafka_source.egfr, kafka_source.first_visit, kafka_source.diagnose_date, kafka_source.a, kafka_source.t, kafka_source.n, kafka_source.memoria, kafka_source.memoria_esordio, kafka_source.fx_esecutive, kafka_source.fx_esecutive_esordio, kafka_source.fx_visuo_spaziali, kafka_source.fx_visuo_spaziali_esordio, kafka_source.linguaggio, kafka_source.linguaggio_esordio, kafka_source.fx_pratto_gnosiche, kafka_source.fx_pratto_gnosiche_esordio, kafka_source.social_cognition, kafka_source.social_cognition_esordio, kafka_source.comportamento, kafka_source.comportamento_esordio, kafka_source.extrapiramidale, kafka_source.adl, kafka_source.iadl, kafka_source.cdr, kafka_source.cdr_sob, kafka_source.tau_totale_liquor, kafka_source.ptau_181_liquor, kafka_source.ttau_ptau, kafka_source.mta, kafka_source.fazekas, kafka_source.koedam, kafka_source.gca, kafka_source.vascular, kafka_source.pet_fdg, kafka_source.spect, kafka_source.pet_a, kafka_source.mmse_raw, kafka_source.mmse_corr, kafka_source.fab_raw, kafka_source.fab_corr, kafka_source.memoria_di_prosa_immediata_raw, kafka_source.memoria_di_prosa_immediata_corr, kafka_source.memoria_di_prosa_differita_raw, kafka_source.memoria_di_prosa_differita_corr, kafka_source.fcsrt_immediate_free_recall_raw, kafka_source.fcsrt_immediate_free_recall_corr, kafka_source.fcsrt_delayed_free_recall_raw, kafka_source.fcsrt_delayed_free_recall_corr, kafka_source.fcsrt_isc, kafka_source.fcsrt_itr, kafka_source.fcsrt_dtr, kafka_source.ravlt_immediato_raw, kafka_source.ravlt_immediato_corr, kafka_source.ravlt_differito_raw, kafka_source.ravlt_differito_corr, kafka_source.ravlt_recognition, kafka_source.digit_span_diretto_raw, kafka_source.digit_span_diretto_corr, kafka_source.digit_span_inverso_raw, kafka_source.digit_span_inverso_corr, kafka_source.corsi_block_tapping_test_raw, kafka_source.corsi_block_tapping_test_corr, kafka_source.figura_di_rey_differita, kafka_source.figura_di_rey_differita_corr, kafka_source.matrici_attentive_raw, kafka_source.matrici_attentive_corr, kafka_source.tmt_a_raw, kafka_source.tmt_a_corr, kafka_source.tmt_b_raw, kafka_source.tmt_b_corr, kafka_source.stroop_test_tempo_raw, kafka_source.stroop_test_tempo_corr, kafka_source.stroop_test_errori_raw, kafka_source.stroop_test_errori_corr, kafka_source.fluenza_verbale_fonemica_raw, kafka_source.fluenza_verbale_fonemica_corr, kafka_source.fluenza_verbale_semantica_raw, kafka_source.fluenza_verbale_semantica_corr, kafka_source.clock_drawing_test_raw, kafka_source.figura_di_rey_copia, kafka_source.test_di_prassia_costruttiva_raw, kafka_source.test_di_prassia_costruttiva_corr, kafka_source.gds, kafka_source.bdi, kafka_source.stai_i, kafka_source.stai_ii, kafka_source.social_cognition_gs_raw, kafka_source.social_cognition_gs_corr, kafka_source.social_cognition_ia_raw, kafka_source.social_cognition_ia_corr, kafka_source.social_cognition_ea_raw, kafka_source.social_cognition_ea_corr, kafka_source.social_cognition_ci_raw, kafka_source.social_cognition_ci_corr, kafka_source.cri_totale_raw, kafka_source.cri_tempo_libero_raw, kafka_source.cri_lavoro_raw, kafka_source.cri_scuola_raw, kafka_source.test_linguistici_nndd, kafka_source._timestamp);

        
        MERGE INTO hive.default.patients AS target_patients
        USING (
            SELECT owner_id, id, hsa_miR_1539, hsa_miR_6840_3p, hsa_miR_6836_3p, hsa_miR_4667_5p, hsa_miR_208a_5p, hsa_miR_6885_5p, hsa_miR_1306_5p, hsa_miR_3184_5p, hsa_miR_4649_5p, hsa_miR_6859_3p, hsa_miR_6829_3p, hsa_miR_3622a_3p, hsa_miR_4664_3p, hsa_miR_6776_3p, hsa_miR_135a_3p, hsa_miR_6875_5p, hsa_miR_3646, hsa_miR_3614_5p, hsa_miR_128_1_5p, hsa_miR_6813_3p, hsa_miR_6752_5p, hsa_miR_204_3p, hsa_miR_6806_5p, hsa_miR_1538, hsa_miR_6887_3p, hsa_miR_5088_3p, hsa_miR_6743_5p, hsa_miR_4274, hsa_miR_5585_3p, hsa_miR_4787_5p, hsa_miR_320b, hsa_miR_6870_3p, hsa_miR_199a_5p, hsa_miR_4290, hsa_miR_6721_5p, hsa_miR_4728_3p, hsa_miR_3691_5p, hsa_miR_4440, hsa_miR_874_3p, hsa_miR_27a_3p, hsa_miR_2278, hsa_miR_150_3p, hsa_miR_4716_3p, hsa_miR_211_5p, hsa_miR_125a_5p, hsa_miR_4741, hsa_miR_3122, hsa_miR_3180_5p, hsa_miR_574_3p, hsa_miR_150_5p, hsa_miR_133b, hsa_miR_30c_5p, hsa_miR_212_3p, hsa_miR_92b_3p, hsa_miR_504_3p, ath_miR_159a, _timestamp
            FROM kafka.devprin.\"mir-results\"
            WHERE _timestamp >= from_unixtime($START_TIMESTAMP) AND _timestamp < from_unixtime($END_TIMESTAMP)
        ) AS kafka_source
        ON target_patients.id = kafka_source.id AND target_patients.owner_id = kafka_source.owner_id
        WHEN MATCHED THEN
            UPDATE SET target_patients.hsa_miR_1539 = kafka_source.hsa_miR_1539, target_patients.hsa_miR_6840_3p = kafka_source.hsa_miR_6840_3p, target_patients.hsa_miR_6836_3p = kafka_source.hsa_miR_6836_3p, target_patients.hsa_miR_4667_5p = kafka_source.hsa_miR_4667_5p, target_patients.hsa_miR_208a_5p = kafka_source.hsa_miR_208a_5p, target_patients.hsa_miR_6885_5p = kafka_source.hsa_miR_6885_5p, target_patients.hsa_miR_1306_5p = kafka_source.hsa_miR_1306_5p, target_patients.hsa_miR_3184_5p = kafka_source.hsa_miR_3184_5p, target_patients.hsa_miR_4649_5p = kafka_source.hsa_miR_4649_5p, target_patients.hsa_miR_6859_3p = kafka_source.hsa_miR_6859_3p, target_patients.hsa_miR_6829_3p = kafka_source.hsa_miR_6829_3p, target_patients.hsa_miR_3622a_3p = kafka_source.hsa_miR_3622a_3p, target_patients.hsa_miR_4664_3p = kafka_source.hsa_miR_4664_3p, target_patients.hsa_miR_6776_3p = kafka_source.hsa_miR_6776_3p, target_patients.hsa_miR_135a_3p = kafka_source.hsa_miR_135a_3p, target_patients.hsa_miR_6875_5p = kafka_source.hsa_miR_6875_5p, target_patients.hsa_miR_3646 = kafka_source.hsa_miR_3646, target_patients.hsa_miR_3614_5p = kafka_source.hsa_miR_3614_5p, target_patients.hsa_miR_128_1_5p = kafka_source.hsa_miR_128_1_5p, target_patients.hsa_miR_6813_3p = kafka_source.hsa_miR_6813_3p, target_patients.hsa_miR_6752_5p = kafka_source.hsa_miR_6752_5p, target_patients.hsa_miR_204_3p = kafka_source.hsa_miR_204_3p, target_patients.hsa_miR_6806_5p = kafka_source.hsa_miR_6806_5p, target_patients.hsa_miR_1538 = kafka_source.hsa_miR_1538, target_patients.hsa_miR_6887_3p = kafka_source.hsa_miR_6887_3p, target_patients.hsa_miR_5088_3p = kafka_source.hsa_miR_5088_3p, target_patients.hsa_miR_6743_5p = kafka_source.hsa_miR_6743_5p, target_patients.hsa_miR_4274 = kafka_source.hsa_miR_4274, target_patients.hsa_miR_5585_3p = kafka_source.hsa_miR_5585_3p, target_patients.hsa_miR_4787_5p = kafka_source.hsa_miR_4787_5p, target_patients.hsa_miR_320b = kafka_source.hsa_miR_320b, target_patients.hsa_miR_6870_3p = kafka_source.hsa_miR_6870_3p, target_patients.hsa_miR_199a_5p = kafka_source.hsa_miR_199a_5p, target_patients.hsa_miR_4290 = kafka_source.hsa_miR_4290, target_patients.hsa_miR_6721_5p = kafka_source.hsa_miR_6721_5p, target_patients.hsa_miR_4728_3p = kafka_source.hsa_miR_4728_3p, target_patients.hsa_miR_3691_5p = kafka_source.hsa_miR_3691_5p, target_patients.hsa_miR_4440 = kafka_source.hsa_miR_4440, target_patients.hsa_miR_874_3p = kafka_source.hsa_miR_874_3p, target_patients.hsa_miR_27a_3p = kafka_source.hsa_miR_27a_3p, target_patients.hsa_miR_2278 = kafka_source.hsa_miR_2278, target_patients.hsa_miR_150_3p = kafka_source.hsa_miR_150_3p, target_patients.hsa_miR_4716_3p = kafka_source.hsa_miR_4716_3p, target_patients.hsa_miR_211_5p = kafka_source.hsa_miR_211_5p, target_patients.hsa_miR_125a_5p = kafka_source.hsa_miR_125a_5p, target_patients.hsa_miR_4741 = kafka_source.hsa_miR_4741, target_patients.hsa_miR_3122 = kafka_source.hsa_miR_3122, target_patients.hsa_miR_3180_5p = kafka_source.hsa_miR_3180_5p, target_patients.hsa_miR_574_3p = kafka_source.hsa_miR_574_3p, target_patients.hsa_miR_150_5p = kafka_source.hsa_miR_150_5p, target_patients.hsa_miR_133b = kafka_source.hsa_miR_133b, target_patients.hsa_miR_30c_5p = kafka_source.hsa_miR_30c_5p, target_patients.hsa_miR_212_3p = kafka_source.hsa_miR_212_3p, target_patients.hsa_miR_92b_3p = kafka_source.hsa_miR_92b_3p, target_patients.hsa_miR_504_3p = kafka_source.hsa_miR_504_3p, target_patients.ath_miR_159a = kafka_source.ath_miR_159a, target_patients.mir_results_upsert_at = kafka_source._timestamp
        WHEN NOT MATCHED THEN          
            INSERT (owner_id, id, hsa_miR_1539, hsa_miR_6840_3p, hsa_miR_6836_3p, hsa_miR_4667_5p, hsa_miR_208a_5p, hsa_miR_6885_5p, hsa_miR_1306_5p, hsa_miR_3184_5p, hsa_miR_4649_5p, hsa_miR_6859_3p, hsa_miR_6829_3p, hsa_miR_3622a_3p, hsa_miR_4664_3p, hsa_miR_6776_3p, hsa_miR_135a_3p, hsa_miR_6875_5p, hsa_miR_3646, hsa_miR_3614_5p, hsa_miR_128_1_5p, hsa_miR_6813_3p, hsa_miR_6752_5p, hsa_miR_204_3p, hsa_miR_6806_5p, hsa_miR_1538, hsa_miR_6887_3p, hsa_miR_5088_3p, hsa_miR_6743_5p, hsa_miR_4274, hsa_miR_5585_3p, hsa_miR_4787_5p, hsa_miR_320b, hsa_miR_6870_3p, hsa_miR_199a_5p, hsa_miR_4290, hsa_miR_6721_5p, hsa_miR_4728_3p, hsa_miR_3691_5p, hsa_miR_4440, hsa_miR_874_3p, hsa_miR_27a_3p, hsa_miR_2278, hsa_miR_150_3p, hsa_miR_4716_3p, hsa_miR_211_5p, hsa_miR_125a_5p, hsa_miR_4741, hsa_miR_3122, hsa_miR_3180_5p, hsa_miR_574_3p, hsa_miR_150_5p, hsa_miR_133b, hsa_miR_30c_5p, hsa_miR_212_3p, hsa_miR_92b_3p, hsa_miR_504_3p, ath_miR_159a, mir_results_upsert_at)
            VALUES (kafka_source.owner_id, kafka_source.id, kafka_source.hsa_miR_1539, kafka_source.hsa_miR_6840_3p, kafka_source.hsa_miR_6836_3p, kafka_source.hsa_miR_4667_5p, kafka_source.hsa_miR_208a_5p, kafka_source.hsa_miR_6885_5p, kafka_source.hsa_miR_1306_5p, kafka_source.hsa_miR_3184_5p, kafka_source.hsa_miR_4649_5p, kafka_source.hsa_miR_6859_3p, kafka_source.hsa_miR_6829_3p, kafka_source.hsa_miR_3622a_3p, kafka_source.hsa_miR_4664_3p, kafka_source.hsa_miR_6776_3p, kafka_source.hsa_miR_135a_3p, kafka_source.hsa_miR_6875_5p, kafka_source.hsa_miR_3646, kafka_source.hsa_miR_3614_5p, kafka_source.hsa_miR_128_1_5p, kafka_source.hsa_miR_6813_3p, kafka_source.hsa_miR_6752_5p, kafka_source.hsa_miR_204_3p, kafka_source.hsa_miR_6806_5p, kafka_source.hsa_miR_1538, kafka_source.hsa_miR_6887_3p, kafka_source.hsa_miR_5088_3p, kafka_source.hsa_miR_6743_5p, kafka_source.hsa_miR_4274, kafka_source.hsa_miR_5585_3p, kafka_source.hsa_miR_4787_5p, kafka_source.hsa_miR_320b, kafka_source.hsa_miR_6870_3p, kafka_source.hsa_miR_199a_5p, kafka_source.hsa_miR_4290, kafka_source.hsa_miR_6721_5p, kafka_source.hsa_miR_4728_3p, kafka_source.hsa_miR_3691_5p, kafka_source.hsa_miR_4440, kafka_source.hsa_miR_874_3p, kafka_source.hsa_miR_27a_3p, kafka_source.hsa_miR_2278, kafka_source.hsa_miR_150_3p, kafka_source.hsa_miR_4716_3p, kafka_source.hsa_miR_211_5p, kafka_source.hsa_miR_125a_5p, kafka_source.hsa_miR_4741, kafka_source.hsa_miR_3122, kafka_source.hsa_miR_3180_5p, kafka_source.hsa_miR_574_3p, kafka_source.hsa_miR_150_5p, kafka_source.hsa_miR_133b, kafka_source.hsa_miR_30c_5p, kafka_source.hsa_miR_212_3p, kafka_source.hsa_miR_92b_3p, kafka_source.hsa_miR_504_3p, kafka_source.ath_miR_159a, kafka_source._timestamp);
    

        COMMIT;
    " && { echo "CDC Completed successfully"; RUN_SUCCESS=1; } || { echo "CDC process failed"; RUN_SUCCESS=0; }

    sleep "$FLUSH_DELAY_SECONDS"
done
